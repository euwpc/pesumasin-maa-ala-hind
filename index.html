<script>
async function loadPrice() {
  try {
    const res = await fetch("./price.json?t=" + Date.now(), { cache:"no-store" });
    const data = await res.json();

    document.getElementById("price").textContent = data.price + " ğŸ’";

    // ---------------------------
    // Display warning if needed
    // ---------------------------
    const warningElem = document.getElementById("warning");
    const fc = data.forecast;

    const threshold = fc.expectedChange >= 10;  // big move
    const rare = fc.rarity === "Rare" || fc.rarity === "Extremely Rare";

    if (threshold && rare) {
      warningElem.innerHTML = `
        <div class="warningBox">
          âš ï¸ Suur hinnatÃµus tÃµenÃ¤oline jÃ¤rgmisel uuendusel (${fc.expectedChange} ğŸ’ Â· ${fc.rarity})
        </div>
      `;
    } else {
      warningElem.innerHTML = "";
    }

    // ---------------------------
    // History rendering
    // ---------------------------
    const history = data.history || [];
    document.getElementById("history").innerHTML = history.map(h => {
      const cls = h.change > 0 ? "up" : "down";
      const sign = h.change > 0 ? "+" : "";
      const date = new Date(h.timestamp).toLocaleString();
      return `
        <div class="entry ${cls}">
          <div>
            <strong class="${cls}">${sign}${h.change}</strong>
            <div class="timestamp">${date}</div>
          </div>
          <div style="text-align:right;">
            <div class="badge">${h.rarity}</div>
            <div class="timestamp">${h.newPrice} ğŸ’</div>
          </div>
        </div>
      `;
    }).join("");

  } catch (err) {
    console.error(err);
  }
}

loadPrice();
setInterval(loadPrice, 5 * 60 * 1000);
</script>
