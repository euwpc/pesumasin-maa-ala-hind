<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Maa-ala hind</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* Minimal styling to show price & history nicely */
    body { background:#071326; color:#e8f1ff; font-family:system-ui,Segoe UI,Roboto,Arial; display:flex; justify-content:center; padding:40px; }
    .card { width:420px; background:rgba(255,255,255,0.04); padding:28px; border-radius:16px; backdrop-filter: blur(8px); }
    h1 { margin:0 0 10px 0; color: #9be7ff; }
    .price { font-size:48px; font-weight:700; margin: 8px 0 18px; }
    .up { color:#ff6b6b; } .down { color:#6ef1a3; }
    .history { max-height:300px; overflow:auto; padding-left:6px; }
    .entry { display:flex; justify-content:space-between; padding:8px 6px; border-radius:8px; margin:8px 0; background:rgba(255,255,255,0.02); }
    .rarity { font-size:12px; opacity:0.8; }
    .timestamp { font-size:12px; opacity:0.7; }
    .badge { padding:4px 8px; border-radius:999px; font-size:12px; background:rgba(255,255,255,0.03); }
  </style>
</head>
<body>
  <div class="card">
    <h1>Praegune Maa-ala hind</h1>
    <div id="price" class="price">â€”</div>
    <div class="history" id="history"></div>
  </div>

  <script>
    async function loadPrice() {
      try {
        // force fresh copy to avoid caching
        const url = './price.json?t=' + Date.now();
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error('Failed to load price.json: ' + res.status);
        const data = await res.json();

        document.getElementById('price').textContent = data.price + ' ðŸ’Ž';

        const history = data.history || [];
        const historyHtml = history.map(h => {
          const cls = (h.change > 0) ? 'up' : 'down';
          const sign = h.change > 0 ? '+' : '';
          const date = new Date(h.timestamp).toLocaleString();
          return `
            <div class="entry ${cls}">
              <div>
                <div><strong class="${cls}">${sign}${h.change}</strong></div>
                <div class="timestamp">${date}</div>
              </div>
              <div style="text-align:right;">
                <div class="badge">${h.rarity}</div>
                <div class="timestamp">new: ${h.newPrice}</div>
              </div>
            </div>
          `;
        }).join('');
        document.getElementById('history').innerHTML = historyHtml;

      } catch (err) {
        console.error(err);
        document.getElementById('price').textContent = 'Error';
        document.getElementById('history').textContent = 'Could not load price.json â€” check file path and Actions.';
      }
    }

    // Load once on page open and then refresh the view every 5 minutes (does not change the price).
    loadPrice();
    setInterval(loadPrice, 5 * 60 * 1000);
  </script>
</body>
</html>
